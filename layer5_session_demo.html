<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSI Layer 5: Session Layer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        h2 {
            margin-top: 30px;
            margin-bottom: 15px;
            font-size: 1.8em;
            color: #f0f0f0;
        }
        
        .demo-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            min-height: 400px;
        }
        
        .client, .server {
            width: 200px;
            height: 250px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .client {
            background: rgba(52, 152, 219, 0.3);
        }
        
        .server {
            background: rgba(46, 204, 113, 0.3);
        }
        
        .device-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }
        
        .connection-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .session-line {
            width: 300px;
            height: 4px;
            background: #ecf0f1;
            border-radius: 2px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .data-packet {
            width: 30px;
            height: 20px;
            background: #e74c3c;
            border-radius: 3px;
            position: absolute;
            top: -8px;
            left: -30px;
            transition: all 2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        .data-packet.moving-right {
            left: 300px;
        }
        
        .data-packet.moving-left {
            left: -30px;
            background: #9b59b6;
        }
        
        .session-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            min-height: 140px;
            width: 300px;
            text-align: center;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .step-controls {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .protocol-selector {
            margin: 20px 0;
            text-align: center;
        }
        
        select {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 16px;
            backdrop-filter: blur(5px);
        }
        
        select option {
            background: #667eea;
            color: white;
        }
        
        .status {
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.establishing {
            background: rgba(241, 196, 15, 0.3);
        }
        
        .status.active {
            background: rgba(46, 204, 113, 0.3);
        }
        
        .status.terminating {
            background: rgba(231, 76, 60, 0.3);
        }
        
        .status.idle {
            background: rgba(149, 165, 166, 0.3);
        }
        
        .phase-indicator {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        
        .phase {
            width: 120px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 5px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .phase.active {
            background: rgba(46, 204, 113, 0.5);
            transform: scale(1.1);
        }
        
        .protocol-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .layer5-explanation {
            background: rgba(142, 68, 173, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .step-counter {
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 15px;
            border-radius: 15px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .session-characteristics {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .characteristic {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            margin: 5px;
            border-radius: 10px;
            width: calc(50% - 30px);
            box-sizing: border-box;
        }
        
        .highlight {
            color: #f39c12;
            font-weight: bold;
        }
        
        .wireshark-packet {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 16px 20px;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.15em;
            color: #00ff00;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.6;
            min-height: 120px;
            max-height: 400px;
            overflow-x: auto;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
        }
        
        .packet-explanation {
            background: rgba(41, 128, 185, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 0.9em;
            border-left: 4px solid #3498db;
        }
        
        .back-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* Dark Mode Toggle */
        .dark-mode-toggle{position:fixed;top:20px;right:20px;z-index:1000;background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.3);border-radius:25px;padding:10px 20px;cursor:pointer;backdrop-filter:blur(10px);transition:all 0.3s ease;display:flex;align-items:center;gap:8px;font-size:16px;color:white;}
        .dark-mode-toggle:hover{background:rgba(255,255,255,0.3);transform:translateY(-2px);}
        body.dark-mode{background:linear-gradient(135deg,#1a1a1a 0%,#2d2d2d 100%);}
        body.dark-mode .container{background:rgba(0,0,0,0.4);}
        body.dark-mode .layer5-explanation,body.dark-mode .content-box,body.dark-mode .protocol-info,body.dark-mode .example-box{background:rgba(0,0,0,0.5);}
    </style>
</head>
<body>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode"><span id="darkModeIcon">üåô</span><span id="darkModeText">Dark Mode</span></button>
    <div class="container">
        <a href="index.html" class="back-button">‚Üê Back to OSI Overview</a>
        
        <h1>üåê OSI Layer 5: Session Layer</h1>
        
        <div class="layer5-explanation">
            <h2>Layer 5 (Session) Protocols</h2>
            <p>
                The <span class="highlight">Session Layer</span> is responsible for establishing, managing, and terminating 
                logical <span class="highlight">connections (sessions) between applications</span>. Unlike the Transport Layer (Layer 4) 
                which handles reliable data transfer, Layer 5 provides the mechanisms for:
            </p>
            
            <div class="session-characteristics">
                <div class="characteristic">
                    <strong>Session Establishment</strong> - Authenticating users, negotiating parameters, setting up communication contexts
                </div>
                <div class="characteristic">
                    <strong>Dialogue Management</strong> - Controlling which party can transmit at what time (full/half-duplex)
                </div>
                <div class="characteristic">
                    <strong>Synchronisation</strong> - Setting checkpoints for long data transfers to allow recovery from failures
                </div>
                <div class="characteristic">
                    <strong>Session Termination</strong> - Gracefully closing sessions and cleaning up resources
                </div>
            </div>
            
            <p>
                <strong>The Critical Distinction:</strong> While the Transport Layer (4) establishes <span class="highlight">connections between hosts</span>,
                the Session Layer (5) establishes <span class="highlight">logical relationships between applications</span> and manages 
                the conversation's state and context.
            </p>
        </div>
        
        <div class="protocol-selector">
            <label for="protocolSelect">Choose Protocol: </label>
            <select id="protocolSelect">
                <option value="smb">SMB (File Sharing)</option>
                <option value="sql">SQL Database Session</option>
                <option value="rpc">RPC (Remote Procedure Call)</option>
                <option value="netbios">NetBIOS Session</option>
            </select>
        </div>
        
        <div class="demo-area">
            <div class="client">
                <div class="device-icon">üíª</div>
                <h3>Client</h3>
                <div id="clientStatus">Ready</div>
            </div>
            
            <div class="connection-area">
                <div class="phase-indicator">
                    <div class="phase" id="phase1">Establish</div>
                    <div class="phase" id="phase2">Manage</div>
                    <div class="phase" id="phase3">Terminate</div>
                </div>
                
                <div class="session-line">
                    <div class="data-packet" id="packet1"></div>
                    <div class="data-packet" id="packet2"></div>
                </div>
                
                <div class="session-info" id="sessionInfo">
                    <strong>Session Status:</strong>
                    <div id="statusText">Select a protocol and mode to begin</div>
                    <div id="stepCounter" class="step-counter">Step 0 of 0</div>
                    <div id="wiresharkExample" class="wireshark-packet" style="display:none;"></div>
                    <div id="packetExplanation" class="packet-explanation" style="display:none;"></div>
                </div>
                
                <div class="status idle" id="overallStatus">Session Idle</div>
            </div>
            
            <div class="server">
                <div class="device-icon">üñ•Ô∏è</div>
                <h3>Server</h3>
                <div id="serverStatus">Listening</div>
            </div>
        </div>
        
        <div class="controls">
            <button class="btn" id="startDemo" onclick="startDemo()">üöÄ Auto Demo</button>
            <button class="btn" id="manualDemo" onclick="startManualDemo()">üëã Manual Demo</button>
            <button class="btn" onclick="resetDemo()">üîÑ Reset</button>
            
            <div class="step-controls">
                <button class="btn" id="prevStepBtn" onclick="prevStep()" disabled>‚Üê Previous Step</button>
                <button class="btn" id="nextStepBtn" onclick="nextStep()" disabled>Next Step ‚Üí</button>
            </div>
        </div>
        
        <div class="protocol-info" id="protocolDetails">
            <h3>Protocol Information</h3>
            <div id="protocolDescription">Select a protocol and click "Protocol Details" to learn more.</div>
            <div id="layer5Evidence" style="margin-top: 15px;"></div>
        </div>
        
        <!-- Comprehensive Educational Content -->
        <div class="content-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin: 30px 0;">
            <div class="content-box" style="background: rgba(0, 0, 0, 0.3); padding: 25px; border-radius: 15px; border-left: 4px solid #667eea;">
                <h3>üéØ Primary Functions</h3>
                <ul>
                    <li><strong>Session Establishment:</strong> Authenticating users and setting up communication contexts</li>
                    <li><strong>Dialogue Management:</strong> Controlling full-duplex or half-duplex communication</li>
                    <li><strong>Synchronisation:</strong> Managing checkpoints for data recovery</li>
                    <li><strong>Session Management:</strong> Maintaining session state and context</li>
                    <li><strong>Session Termination:</strong> Gracefully closing sessions and cleaning up resources</li>
                </ul>
            </div>
            
            <div class="content-box" style="background: rgba(0, 0, 0, 0.3); padding: 25px; border-radius: 15px; border-left: 4px solid #667eea;">
                <h3>üîß Key Characteristics</h3>
                <ul>
                    <li><span class="highlight">Session IDs:</span> Unique identifiers for each communication session</li>
                    <li><span class="highlight">Authentication:</span> User/service authentication and authorisation</li>
                    <li><span class="highlight">State Management:</span> Maintaining conversation context and history</li>
                    <li><span class="highlight">Checkpointing:</span> Recovery points for long-running sessions</li>
                    <li><span class="highlight">Session Timeouts:</span> Automatic cleanup of inactive sessions</li>
                </ul>
            </div>
        </div>
        
        <div class="content-box" style="background: rgba(0, 0, 0, 0.3); padding: 25px; border-radius: 15px; border-left: 4px solid #667eea;">
            <h3>üåê Session Layer Protocols & Technologies</h3>
            <div class="protocols-list" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                <div class="protocol-card" style="background: rgba(102, 126, 234, 0.3); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.2);">
                    <strong>SMB (Server Message Block)</strong>
                    <p>Network file sharing with persistent sessions and authentication</p>
                    <div class="wireshark-example" style="background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 12px; margin: 12px 0; font-family: 'Courier New', monospace; color: #00ff00; font-size: 1.1em;">SMB2 Session Setup Request [NTLMSSP_AUTH]</div>
                    <small>Manages file access sessions with authentication and tree connections</small>
                </div>
                
                <div class="protocol-card" style="background: rgba(102, 126, 234, 0.3); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.2);">
                    <strong>SQL Database Sessions</strong>
                    <p>Database connections with transaction context and state</p>
                    <div class="wireshark-example" style="background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 12px; margin: 12px 0; font-family: 'Courier New', monospace; color: #00ff00; font-size: 1.1em;">TDS Login Response [Success] Session ID: 12345</div>
                    <small>Maintains database connection state and transaction context</small>
                </div>
                
                <div class="protocol-card" style="background: rgba(102, 126, 234, 0.3); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.2);">
                    <strong>RPC (Remote Procedure Call)</strong>
                    <p>Session-based remote function execution with state management</p>
                    <div class="wireshark-example" style="background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 12px; margin: 12px 0; font-family: 'Courier New', monospace; color: #00ff00; font-size: 1.1em;">RPC Call XID: 12345 [AUTH_UNIX established]</div>
                    <small>Manages stateful remote procedure calls with session context</small>
                </div>
                
                <div class="protocol-card" style="background: rgba(102, 126, 234, 0.3); padding: 20px; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.2);">
                    <strong>NetBIOS Session</strong>
                    <p>Named session services for network applications</p>
                    <div class="wireshark-example" style="background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 12px; margin: 12px 0; font-family: 'Courier New', monospace; color: #00ff00; font-size: 1.1em;">NBSS Positive Session Response</div>
                    <small>Establishes named sessions between applications on the network</small>
                </div>
            </div>
        </div>
        
        <div class="example-box" style="background: rgba(41, 128, 185, 0.3); padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #3498db;">
            <h3>üîç Real-World Example: Database Session Lifecycle</h3>
            <p><strong>Scenario:</strong> Web application connecting to database server</p>
            
            <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <h4>Phase 1: Session Establishment</h4>
                <p>Application establishes database session with authentication:</p>
                <div class="wireshark-example" style="background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 10px; margin: 10px 0; font-family: 'Courier New', monospace; color: #00ff00;">
                1. TDS Login Packet: User='webapp' DB='inventory'<br>
                2. Authentication Challenge: [NTLM Challenge]<br>
                3. TDS Login Response: [Success] Session ID: 0x4A2B<br>
                4. Environment Setup: Default schema, collation, etc.
                </div>
            </div>
            
            <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <h4>Phase 2: Session Management</h4>
                <p>Application performs multiple operations within the session:</p>
                <div class="wireshark-example" style="background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 10px; margin: 10px 0; font-family: 'Courier New', monospace; color: #00ff00;">
                5. BEGIN TRANSACTION (Session context maintained)<br>
                6. SELECT queries use session variables and temp tables<br>
                7. Session timeout extended with activity<br>
                8. COMMIT TRANSACTION (Session state updated)
                </div>
            </div>
            
            <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <h4>Phase 3: Session Termination</h4>
                <p>Clean session closure with resource cleanup:</p>
                <div class="wireshark-example" style="background: rgba(0, 0, 0, 0.4); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 10px; margin: 10px 0; font-family: 'Courier New', monospace; color: #00ff00;">
                9. Application sends logout request<br>
                10. Database cleans up session resources<br>
                11. Session ID 0x4A2B invalidated<br>
                12. Connection closed gracefully
                </div>
            </div>
        </div>
        
        <div class="example-box" style="background: rgba(41, 128, 185, 0.3); padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #3498db;">
            <h3>üõ†Ô∏è Troubleshooting Session Layer Issues</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                <div style="background: rgba(231, 76, 60, 0.2); padding: 15px; border-radius: 8px;">
                    <h4>üö® Common Session Problems</h4>
                    <ul>
                        <li>Session timeouts and expired credentials</li>
                        <li>Authentication failures and authorisation issues</li>
                        <li>Session state corruption or loss</li>
                        <li>Resource leaks from improper session cleanup</li>
                        <li>Concurrent session limits exceeded</li>
                        <li>Session hijacking and security breaches</li>
                    </ul>
                </div>
                
                <div style="background: rgba(46, 204, 113, 0.2); padding: 15px; border-radius: 8px;">
                    <h4>üîß Session Diagnostic Tools</h4>
                    <ul>
                        <li>Session monitoring and logging tools</li>
                        <li>Authentication system logs and traces</li>
                        <li>Database connection pool monitors</li>
                        <li>SMB session and file access logs</li>
                        <li>NetBIOS session service analysis</li>
                        <li>Session security audit tools</li>
                    </ul>
                </div>
            </div>
            
            <h4>Common Wireshark Filters for Session Analysis:</h4>
            <div class="wireshark-example" style="background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 8px; padding: 12px; margin: 12px 0; font-family: 'Courier New', monospace; color: #00ff00; font-size: 1.1em;">
            smb2.cmd == 1                    # SMB2 Session Setup<br>
            tds.type == 4                    # TDS Login packets<br>
            rpc.auth_type == 1               # RPC Authentication<br>
            ntlmssp.messagetype == 3         # NTLM Authentication<br>
            nbss.type == 0x81                # NetBIOS Session Service
            </div>
        </div>
        
        <div class="example-box" style="background: rgba(41, 128, 185, 0.3); padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #3498db;">
            <h3>üéì Teaching Analogy: Hotel Reservation System</h3>
            <p><strong>Think of the Session Layer like a hotel reservation and stay management system:</strong></p>
            <ul>
                <li><strong>Check-in Process (Session Establishment):</strong> Guest provides ID, gets room key and bracelet</li>
                <li><strong>Room Service Orders (Session Management):</strong> Multiple services under one guest account</li>
                <li><strong>Concierge Services (State Maintenance):</strong> Hotel remembers your preferences and requests</li>
                <li><strong>Activity Timeline (Session Context):</strong> All services linked to your stay record</li>
                <li><strong>Check-out Process (Session Termination):</strong> Final bill, key return, account closure</li>
                <li><strong>Guest History (Session Persistence):</strong> Hotel remembers you for future visits</li>
            </ul>
            <p><em>Just like a hotel manages your entire stay experience, the Session Layer manages the entire communication experience between applications!</em></p>
        </div>
        
        <div class="content-box" style="background: rgba(0, 0, 0, 0.3); padding: 25px; border-radius: 15px; border-left: 4px solid #667eea;">
            <h3>üìö Key Learning Points</h3>
            <ul>
                <li>Session Layer manages <span class="highlight">logical connections between applications</span>, not just hosts</li>
                <li><span class="highlight">Authentication and authorisation</span> happen at the session level</li>
                <li><span class="highlight">Session state management</span> maintains context across multiple transactions</li>
                <li><span class="highlight">Dialogue control</span> manages who can communicate when (full/half-duplex)</li>
                <li><span class="highlight">Synchronisation checkpoints</span> enable recovery from failures</li>
                <li>Session Layer provides <span class="highlight">persistent application relationships</span> above transport connections</li>
                <li><span class="highlight">Session security</span> protects against hijacking and unauthorized access</li>
            </ul>
        </div>
        
        <div style="text-align: center; margin-top: 40px;">
            <a href="index.html" class="back-button">‚Üê Return to OSI Overview</a>
        </div>
    </div>

    <script>
        let demoRunning = false;
        let currentPhase = 0;
        let currentStepIndex = 0;
        let currentProtocolSteps = [];
        let manualMode = false;
        
        const protocols = {
            smb: {
                name: "SMB (Server Message Block) - File Sharing",
                description: "SMB is a network file sharing protocol that allows applications to read and write to files and request services from server programs. It manages sessions for file access, printing, and inter-process communication.",
                phases: [
                    {
                        text: "Client sends SMB Negotiate request to establish protocol version",
                        wireshark: "SMB2 Negotiate Protocol Request",
                        explanation: "Client asks: 'What SMB versions do you support?' (like asking what language to speak)"
                    },
                    {
                        text: "Server responds with supported SMB dialects and capabilities",
                        wireshark: "SMB2 Negotiate Protocol Response",
                        explanation: "Server replies: 'I support SMB 2.1 and 3.0, here are my security features'"
                    },
                    {
                        text: "Client authenticates and sets up session",
                        wireshark: "SMB2 Session Setup Request (NTLMSSP)",
                        explanation: "Client proves who they are using username/password (like showing ID at hotel)"
                    },
                    {
                        text: "Session established - file operations can begin",
                        wireshark: "SMB2 Session Setup Response [STATUS_SUCCESS]",
                        explanation: "Server says 'Welcome! You're logged in as John_Smith, here's your session ID'"
                    },
                    {
                        text: "Client connects to a shared folder (Tree Connect)",
                        wireshark: "SMB2 Tree Connect Request (\\\\server\\share)",
                        explanation: "Client asks: 'Can I access the Documents folder?' (like asking for room key)"
                    },
                    {
                        text: "Client performs file operations (open/read/write)",
                        wireshark: "SMB2 Create Request / SMB2 Read Request",
                        explanation: "Client says: 'Open report.docx and let me read it' (using the established session)"
                    },
                    {
                        text: "Client disconnects from shared folder",
                        wireshark: "SMB2 Tree Disconnect Request",
                        explanation: "Client: 'I'm done with the Documents folder' (like returning room key)"
                    },
                    {
                        text: "Client logs off and terminates session",
                        wireshark: "SMB2 Logoff Request",
                        explanation: "Client: 'I'm logging out completely' (like checking out of hotel)"
                    }
                ],
                layer5_evidence: [
                    "Creates persistent authenticated session context with session IDs",
                    "Maintains state information across multiple file operations",
                    "Provides synchronisation for file access and locking",
                    "Handles session-level security context between client and server",
                    "Manages session establishment/termination separately from individual transfers",
                    "Implements session timeouts and keep-alive mechanisms"
                ]
            },
            sql: {
                name: "SQL Database Session",
                description: "SQL database sessions manage the connection between client applications and database servers, handling authentication, transaction management, and connection pooling.",
                phases: [
                    {
                        text: "Client initiates connection to database server",
                        wireshark: "MySQL/TDS Login Packet",
                        explanation: "Client: 'Hello database, I want to connect' (like calling a restaurant)"
                    },
                    {
                        text: "Server challenges client with authentication requirements",
                        wireshark: "MySQL/TDS Challenge Response",
                        explanation: "Server: 'Please provide username, password, and database name'"
                    },
                    {
                        text: "Client provides credentials and connection parameters",
                        wireshark: "MySQL/TDS Authentication Response",
                        explanation: "Client: 'I'm user john_doe, password is xyz123, connect me to sales_db'"
                    },
                    {
                        text: "Database session established with transaction context",
                        wireshark: "MySQL/TDS Login Response [Success]",
                        explanation: "Server: 'Welcome! Session ID 12345, transaction autocommit=ON'"
                    },
                    {
                        text: "Client executes SQL queries within session context",
                        wireshark: "MySQL Query Request: SELECT * FROM customers",
                        explanation: "Client runs queries knowing the database context and user permissions"
                    },
                    {
                        text: "Server maintains session state and transaction logs",
                        wireshark: "MySQL Result Set / TDS Response",
                        explanation: "Server tracks what user has done, temporary tables, locks held"
                    },
                    {
                        text: "Client commits/rolls back transactions",
                        wireshark: "MySQL Query: COMMIT / ROLLBACK",
                        explanation: "Client: 'Save all my changes' or 'Undo everything I just did'"
                    },
                    {
                        text: "Session closed and resources cleaned up",
                        wireshark: "MySQL/TDS Logout / Connection Close",
                        explanation: "Server frees memory, releases locks, closes temporary tables"
                    }
                ],
                layer5_evidence: [
                    "Maintains transactional context and consistency across multiple queries",
                    "Preserves client state information (variables, temporary tables, locks)",
                    "Handles session authentication separately from individual queries",
                    "Implements connection pooling for efficient session reuse",
                    "Provides checkpointing for transaction rollback/recovery",
                    "Manages session properties like isolation levels and read-only status"
                ]
            },
            rpc: {
                name: "RPC (Remote Procedure Call)",
                description: "RPC allows programs to execute procedures on remote systems as if they were local function calls. Sessions manage the communication context and state.",
                phases: [
                    {
                        text: "Client locates RPC service using portmapper",
                        wireshark: "Portmapper V2 GETPORT Call",
                        explanation: "Client: 'Where can I find the file service?' (like asking for directions)"
                    },
                    {
                        text: "Client establishes RPC session with server",
                        wireshark: "RPC Call XID:12345 (first call)",
                        explanation: "Client creates a conversation thread with unique ID (XID)"
                    },
                    {
                        text: "Authentication and authorisation performed",
                        wireshark: "RPC Auth: AUTH_UNIX credentials",
                        explanation: "Client proves identity: 'I'm user 1000 from machine workstation1'"
                    },
                    {
                        text: "RPC session context created with unique identifier",
                        wireshark: "RPC Reply XID:12345 [Success]",
                        explanation: "Server: 'OK, you're authenticated, your conversation ID is 12345'"
                    },
                    {
                        text: "Client makes remote procedure calls",
                        wireshark: "NFS V3 LOOKUP Call XID:12346",
                        explanation: "Client: 'Execute lookup_file('report.txt')' - like calling a function remotely"
                    },
                    {
                        text: "Server maintains session state between calls",
                        wireshark: "NFS V3 LOOKUP Reply XID:12346",
                        explanation: "Server remembers client context and returns results in the session"
                    },
                    {
                        text: "Session handles error recovery and timeouts",
                        wireshark: "RPC Retransmission / Duplicate Request",
                        explanation: "If network fails, session can detect and retry lost procedure calls"
                    },
                    {
                        text: "RPC session terminated",
                        wireshark: "TCP FIN (connection close)",
                        explanation: "Session ends when client closes connection - all context is cleaned up"
                    }
                ],
                layer5_evidence: [
                    "Creates and maintains a procedure call context between applications",
                    "Preserves state information between multiple remote procedure calls",
                    "Manages authentication and authorisation at session level",
                    "Handles dialogue control (who can call what and when)",
                    "Implements session recovery mechanisms for fault tolerance",
                    "Provides session termination that cleans up all resources properly"
                ]
            },
            netbios: {
                name: "NetBIOS Session Service",
                description: "NetBIOS provides session services for applications on a network, managing connections between NetBIOS names and handling session establishment/termination.",
                phases: [
                    {
                        text: "Client resolves NetBIOS name to network address",
                        wireshark: "NBNS Name Query NB WORKSTATION<00>",
                        explanation: "Client: 'What's the IP address of computer named WORKSTATION?' (like looking up phone number)"
                    },
                    {
                        text: "Client sends Session Request to target",
                        wireshark: "NBSS Session Request",
                        explanation: "Client: 'LAPTOP wants to start a session with WORKSTATION' (like requesting to speak)"
                    },
                    {
                        text: "Server responds with Session Accept/Reject",
                        wireshark: "NBSS Positive Session Response",
                        explanation: "Server: 'Yes, WORKSTATION accepts session from LAPTOP' (like answering the phone)"
                    },
                    {
                        text: "NetBIOS session established with session number",
                        wireshark: "NBSS Session Message (established)",
                        explanation: "Both sides now have a named session for applications to use"
                    },
                    {
                        text: "Applications exchange data through session",
                        wireshark: "SMB over NetBIOS Session",
                        explanation: "File sharing (SMB) now uses this NetBIOS session as transport"
                    },
                    {
                        text: "Session maintains flow control and sequencing",
                        wireshark: "NBSS Session Keep Alive",
                        explanation: "Session layer ensures data flows properly and connection stays alive"
                    },
                    {
                        text: "Either party can initiate session close",
                        wireshark: "NBSS Session End Request",
                        explanation: "Either computer can say 'I'm done with this conversation'"
                    },
                    {
                        text: "Session terminated and resources released",
                        wireshark: "TCP FIN/RST (underlying connection closes)",
                        explanation: "Session is cleanly closed, names are unregistered, memory freed"
                    }
                ],
                layer5_evidence: [
                    "Establishes named sessions between applications (not just hosts)",
                    "Provides session-level services above the transport layer",
                    "Manages session state with unique session numbers",
                    "Handles session-level flow control and error recovery",
                    "Implements session-specific name resolution services",
                    "Maintains bidirectional full-duplex communication context"
                ]
            }
        };
        
        function updateProtocolInfo() {
            const selected = document.getElementById('protocolSelect').value;
            const protocol = protocols[selected];
            
            document.getElementById('protocolDescription').innerHTML = `
                <strong>${protocol.name}</strong><br><br>
                ${protocol.description}
            `;
            
            document.getElementById('layer5Evidence').innerHTML = "";
        }
        
        function showDetails() {
            const selected = document.getElementById('protocolSelect').value;
            const protocol = protocols[selected];
            
            let phasesList = protocol.phases.map((phase, index) => 
                `<li><strong>Step ${index + 1}:</strong> ${phase.text}</li>`
            ).join('');
            
            let evidenceList = protocol.layer5_evidence.map((evidence) => 
                `<li>${evidence}</li>`
            ).join('');
            
            document.getElementById('protocolDescription').innerHTML = `
                <strong>${protocol.name}</strong><br><br>
                ${protocol.description}<br><br>
                <strong>Session Phases:</strong>
                <ol style="text-align: left; margin-left: 20px;">
                    ${phasesList}
                </ol>
            `;
            
            document.getElementById('layer5Evidence').innerHTML = `
                <strong>Why This Is a Layer 5 (Session) Protocol:</strong>
                <ul style="text-align: left; margin-left: 20px;">
                    ${evidenceList}
                </ul>
            `;
        }
        
        function startManualDemo() {
            if (demoRunning) return;
            
            manualMode = true;
            currentStepIndex = 0;
            const selected = document.getElementById('protocolSelect').value;
            const protocol = protocols[selected];
            currentProtocolSteps = protocol.phases;
            
            document.getElementById('nextStepBtn').disabled = false;
            document.getElementById('prevStepBtn').disabled = true;
            document.getElementById('startDemo').disabled = true;
            document.getElementById('manualDemo').disabled = true;
            
            showStep(0);
        }
        
        function nextStep() {
            if (currentStepIndex < currentProtocolSteps.length - 1) {
                currentStepIndex++;
                showStep(currentStepIndex);
                
                document.getElementById('prevStepBtn').disabled = false;
                
                if (currentStepIndex === currentProtocolSteps.length - 1) {
                    document.getElementById('nextStepBtn').textContent = 'Complete Demo';
                }
            } else {
                document.getElementById('overallStatus').className = 'status idle';
                document.getElementById('overallStatus').textContent = 'Manual Demo Complete';
                resetManualControls();
            }
        }
        
        function prevStep() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                showStep(currentStepIndex);
                
                document.getElementById('nextStepBtn').disabled = false;
                document.getElementById('nextStepBtn').textContent = 'Next Step ‚Üí';
                
                if (currentStepIndex === 0) {
                    document.getElementById('prevStepBtn').disabled = true;
                }
            }
        }
        
        function showStep(stepIndex) {
            const step = currentProtocolSteps[stepIndex];
            document.getElementById('statusText').textContent = step.text;
            document.getElementById('stepCounter').textContent = `Step ${stepIndex + 1} of ${currentProtocolSteps.length}`;
            
            // Show Wireshark packet and explanation
            document.getElementById('wiresharkExample').style.display = 'block';
            document.getElementById('wiresharkExample').textContent = step.wireshark;
            document.getElementById('packetExplanation').style.display = 'block';
            document.getElementById('packetExplanation').textContent = step.explanation;
            
            // Determine phase
            let phaseNum = 1;
            let statusText = "Establishing Session";
            let statusClass = "establishing";
            
            if (stepIndex >= 3 && stepIndex < 6) {
                phaseNum = 2;
                statusText = "Managing Session";
                statusClass = "active";
            } else if (stepIndex >= 6) {
                phaseNum = 3;
                statusText = "Terminating Session";
                statusClass = "terminating";
            }
            
            // Update phase indicator
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById(`phase${phaseNum}`).classList.add('active');
            
            // Update status
            document.getElementById('overallStatus').className = `status ${statusClass}`;
            document.getElementById('overallStatus').textContent = statusText;
            
            // Animate packet
            animatePacketForStep(stepIndex);
        }
        
        function animatePacketForStep(stepIndex) {
            const packet = stepIndex % 2 === 0 ? document.getElementById('packet1') : document.getElementById('packet2');
            const isClientToServer = stepIndex % 2 === 0;
            
            // Reset packets
            document.querySelectorAll('.data-packet').forEach(p => {
                p.classList.remove('moving-right', 'moving-left');
            });
            
            setTimeout(() => {
                if (isClientToServer) {
                    packet.style.background = '#e74c3c';
                    packet.classList.add('moving-right');
                    document.getElementById('clientStatus').textContent = 'Sending...';
                    document.getElementById('serverStatus').textContent = 'Receiving...';
                } else {
                    packet.style.background = '#9b59b6';
                    packet.classList.add('moving-left');
                    document.getElementById('clientStatus').textContent = 'Receiving...';
                    document.getElementById('serverStatus').textContent = 'Sending...';
                }
                
                setTimeout(() => {
                    document.getElementById('clientStatus').textContent = 'Ready';
                    document.getElementById('serverStatus').textContent = 'Ready';
                }, 1800);
            }, 200);
        }
        
        function resetManualControls() {
            manualMode = false;
            document.getElementById('nextStepBtn').disabled = true;
            document.getElementById('prevStepBtn').disabled = true;
            document.getElementById('startDemo').disabled = false;
            document.getElementById('manualDemo').disabled = false;
            document.getElementById('nextStepBtn').textContent = 'Next Step ‚Üí';
            document.getElementById('wiresharkExample').style.display = 'none';
            document.getElementById('packetExplanation').style.display = 'none';
        }
        
        async function startDemo() {
            if (demoRunning || manualMode) return;
            
            demoRunning = true;
            currentPhase = 0;
            const selected = document.getElementById('protocolSelect').value;
            const protocol = protocols[selected];
            
            // Phase 1: Establishment
            await runPhase(1, "Establishing Session", protocol.phases.slice(0, 3));
            
            // Phase 2: Management  
            await runPhase(2, "Managing Session", protocol.phases.slice(3, 6));
            
            // Phase 3: Termination
            await runPhase(3, "Terminating Session", protocol.phases.slice(6, 8));
            
            document.getElementById('overallStatus').className = 'status idle';
            document.getElementById('overallStatus').textContent = 'Session Complete';
            demoRunning = false;
        }
        
        async function runPhase(phaseNum, statusText, steps) {
            // Activate phase indicator
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.getElementById(`phase${phaseNum}`).classList.add('active');
            
            // Update status
            const statusClass = phaseNum === 1 ? 'establishing' : phaseNum === 2 ? 'active' : 'terminating';
            document.getElementById('overallStatus').className = `status ${statusClass}`;
            document.getElementById('overallStatus').textContent = statusText;
            
            // Animate packets and show steps
            for (let i = 0; i < steps.length; i++) {
                document.getElementById('statusText').textContent = steps[i].text;
                document.getElementById('stepCounter').textContent = `Step ${i + 1} of ${steps.length}`;
                
                // Show Wireshark packet
                document.getElementById('wiresharkExample').style.display = 'block';
                document.getElementById('wiresharkExample').textContent = steps[i].wireshark;
                document.getElementById('packetExplanation').style.display = 'block';
                document.getElementById('packetExplanation').textContent = steps[i].explanation;
                
                // Animate packet
                const packet = i % 2 === 0 ? document.getElementById('packet1') : document.getElementById('packet2');
                const isClientToServer = i % 2 === 0;
                
                if (isClientToServer) {
                    packet.style.background = '#e74c3c';
                    packet.classList.add('moving-right');
                    document.getElementById('clientStatus').textContent = 'Sending...';
                    document.getElementById('serverStatus').textContent = 'Receiving...';
                } else {
                    packet.style.background = '#9b59b6';
                    packet.classList.remove('moving-right');
                    packet.classList.add('moving-left');
                    document.getElementById('clientStatus').textContent = 'Receiving...';
                    document.getElementById('serverStatus').textContent = 'Sending...';
                }
                
                await sleep(3000);
                
                // Reset packet position
                packet.classList.remove('moving-right', 'moving-left');
                document.getElementById('clientStatus').textContent = 'Ready';
                document.getElementById('serverStatus').textContent = 'Ready';
                await sleep(1000);
            }
        }
        
        function resetDemo() {
            demoRunning = false;
            currentPhase = 0;
            
            // Reset all visual elements
            document.querySelectorAll('.phase').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.data-packet').forEach(p => {
                p.classList.remove('moving-right', 'moving-left');
            });
            
            document.getElementById('overallStatus').className = 'status idle';
            document.getElementById('overallStatus').textContent = 'Session Idle';
            document.getElementById('statusText').textContent = "Select a protocol and mode to begin";
            document.getElementById('stepCounter').textContent = "Step 0 of 0";
            document.getElementById('clientStatus').textContent = 'Ready';
            document.getElementById('serverStatus').textContent = 'Listening';
            
            resetManualControls();
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Initialise
        document.getElementById('protocolSelect').addEventListener('change', updateProtocolInfo);
        updateProtocolInfo();
        
        // Dark Mode Functions
        function toggleDarkMode(){document.body.classList.toggle('dark-mode');const isDark=document.body.classList.contains('dark-mode');localStorage.setItem('darkMode',isDark);updateDarkModeButton(isDark);}
        function updateDarkModeButton(isDark){const icon=document.getElementById('darkModeIcon');const text=document.getElementById('darkModeText');if(isDark){icon.textContent='‚òÄÔ∏è';text.textContent='Light Mode';}else{icon.textContent='üåô';text.textContent='Dark Mode';}}
        window.addEventListener('DOMContentLoaded',function(){const savedDarkMode=localStorage.getItem('darkMode')==='true';if(savedDarkMode){document.body.classList.add('dark-mode');updateDarkModeButton(true);}});
    </script>
    
    <footer style="background: rgba(0, 0, 0, 0.3); padding: 20px; margin-top: 40px; border-top: 2px solid rgba(255, 255, 255, 0.1); text-align: center; border-radius: 10px;">
        <p style="margin: 0; font-size: 0.9em; line-height: 1.6;">
            Created by Alex for educational purposes ONLY. Please contact me at <a href="mailto:alex@slash-root.com" style="color: #3498db; text-decoration: none;">alex@slash-root.com</a> should you spot any errors or wish to query anything.
        </p>
    </footer>
</body>
</html>
